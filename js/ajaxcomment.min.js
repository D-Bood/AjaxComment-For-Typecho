function AjaxComment_serialize(f){var g,b,e=[];if(typeof f=="object"&&f.nodeName=="FORM"){var a=f.elements.length;for(var d=0;d<a;d++){g=f.elements[d];if(g.name&&!g.disabled&&g.type!="file"&&g.type!="reset"&&g.type!="submit"&&g.type!="button"){if(g.type=="select-multiple"){b=f.elements[d].options.length;for(var c=0;c<b;c++){if(g.options[c].selected){e[e.length]=encodeURIComponent(g.name)+"="+encodeURIComponent(g.options[c].value)}}}else{if((g.type!="checkbox"&&g.type!="radio")||g.checked){e[e.length]=encodeURIComponent(g.name)+"="+encodeURIComponent(g.value)}}}}}return e.join("&").replace(/%20/g,"+")}function AjaxComment_post(a,b,d){var c=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");c.open("POST",a);c.onreadystatechange=function(){if(c.readyState==4){d&&d(c)}};c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(b);return c}function _id(a){return document.getElementById(a)}function parseToDOMs(a){var b=document.createElement("div");b.innerHTML=a;return b.childNodes}function appendChildHtml(d,b){var c=parseToDOMs(b);for(var a=0;a<c.length;a++){if(c[a].nodeType==1){d.appendChild(c[a])}else{if(c[a].nodeType==3&&c[a].textContent.length>2){d.innerHTML+=c[a].textContent}}}}function insertBeforeHtml(e,a,c){var d=parseToDOMs(c);for(var b=0;b<d.length;b++){if(d[b].nodeType==1){e.insertBefore(d[b],a)}else{if(d[b].nodeType==3&&d[b].textContent.length>2){e.innerHTML=d[b].textContent+e.innerHTML}}}}function comment_append(d){var h=0;var c=d.match(/id(\s+|)=(\s+|)("|'|)((.*?)comment-\d+)("|'|\s+|>)/g);if(c){var f=c[0];h=f.match(/\d+/g)[0];id_format=f.replace(h,"{id}").replace(/\s+/g,"").replace(/(id=|"|')/g,"")}if(h==0){d+=success_div}var b=_id(respond_id).getElementsByTagName("form")[0];b.getElementsByTagName("textarea")[0].value="";if(document.getElementsByClassName(comment_list_class_one).length==0){var a=document.createElement(comment_list_element);a.className=comment_list_class;_id(respond_id).parentNode.insertBefore(a,_id(respond_id))}if(_id("comment-parent")==undefined){appendChildHtml(document.getElementsByClassName(comment_list_class_one)[0],d)}else{var g=id_format.replace("{id}",_id("comment-parent").value);TypechoComment.cancelReply();if(_id(g).getElementsByClassName(comment_children_list_class_one).length==0){var e=document.createElement(comment_children_list_element);e.className=comment_children_list_class;_id(g).appendChild(e)}var i=_id(g).getElementsByClassName(comment_children_list_class_one)[0];if(i.innerHTML.indexOf(comment_list_class_one)!=-1){i=i.getElementsByClassName(comment_list_class_one)[0]}else{var a=document.createElement(comment_list_element);a.className=comment_list_class;i.appendChild(a);i=a}if(comments_order=="DESC"){var j=i.childNodes[0];insertBeforeHtml(i,j,d)}else{appendChildHtml(i,d)}}if(h>0){appendChildHtml(_id(id_format.replace("{id}",h)),success_div);location.hash="#"+id_format.replace("{id}",h)}}var r=_id(respond_id);if(null!=r){var forms=r.getElementsByTagName("form");if(forms.length>0){if(_id("AjaxComment_loading")==undefined){appendChildHtml(forms[0].getElementsByTagName("textarea")[0].parentNode,loading_div)}if(_id("AjaxComment_error")==undefined){appendChildHtml(forms[0].getElementsByTagName("textarea")[0].parentNode,error_div)}forms[0].onsubmit=function(){var a=_id(respond_id).getElementsByTagName("form")[0];_id("AjaxComment_loading").style.display="block";_id("AjaxComment_error").style.display="none";AjaxComment_post(ajaxcomment_url,AjaxComment_serialize(a),function(b){_id("AjaxComment_loading").style.display="none";if(b.status==200){comment_append(b.responseText)}else{if(b.status==405){_id("AjaxComment_error").style.display="block";_id("AjaxComment_msg").innerHTML=b.responseText}else{alert("Ajax 未知错误")}}});return false}}};